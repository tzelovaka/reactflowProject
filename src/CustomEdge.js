import React, { useState } from 'react';
import { Handle, Position, useReactFlow, useNodesState, useNodes, useEdges } from 'reactflow';

import './index.css';

function CustomEdge({ id, sourceX, sourceY, targetX, targetY }) {
  const [label, setLabel] = useState('');
  const edges = useEdges();
  const handleInputChange = (event) => {
    setLabel(event.target.value);
    let i;
    edges.forEach((edge) => {if (edge.id === id) i=edges.indexOf(edge) });
    edges[i].data.label = event.target.value;
    console.log(edges);
  };
  const curveX = targetX-125;
  const curveY = targetY-100;
  const [emj, setEmj] = useState('')
  const EmojiDropdown = () => {
    const [isDropdownOpen, setIsDropdownOpen] = useState(false);
    const emojis = [
      "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "üòÇ", "ü§£", "üòä", "üòá",
      "üòâ", "üòå", "üòç", "üòò", "üòó", "üòô", "üòö", "üòã", "üòõ", "üòù",
      "üòú", "ü§™", "ü§®", "üßê", "ü§ì", "üòé", "ü§©", "ü•≥", "üòè", "üòí",
      "üòû", "üòî", "üòü", "üòï", "üôÉ", "üôÇ", "üòê", "üò∂", "üòè", "üò£",
      "üò•", "üòÆ", "ü§ê", "üòØ", "üò™", "üò´", "üò¥", "üòå", "üòõ", "üòú",
      "üòù", "ü§§", "üòí", "üòì", "üòî", "üòï", "üôÉ", "ü§£", "üòÇ", "üò≠",
      "üòñ", "üò≤", "üòß", "üò°", "üò†", "ü§¨", "ü§Ø", "üò≥", "üòµ", "üò±",
      "üò®", "üò∞", "üò¢", "üò•", "üòì", "ü§î", "ü§®", "üò¨", "üò¨", "ü§ê",
      "ü§´", "üò∂", "üò§", "üò∂", "üòï", "üòï", "üòï", "üò©", "üò´", "üò±",
      "üò®", "üò∞", "üò¢", "üòß", "ü§•", "ü§ê", "üò∂", "üò™", "üò™", "üòì",
      "üòÆ", "üòÆ", "üò¶", "ü•±", "üòí", "üò∂", "üòè", "üòè", "üòè", "üò£",
      "ü§£", "üòî", "üò≥", "ü§§", "üòØ", "üò™", "üò´", "üò´", "üò´", "üò´",
      "üò¥", "üòí", "üôÑ", "üòë", "üò¨", "ü§•", "üëÑ", "üëÖ", "üëÜ", "üëá",
      "üëà", "üëâ", "üñï", "ü§û", "üññ", "‚úåÔ∏è", "ü§ò", "üëå", "üëç", "üëé",
      "‚úä", "üëä", "ü§õ", "ü§ú", "ü§ö", "üëã", "ü§ü", "‚úçÔ∏è", "ü§ù", "üôè",
      "üíã", "üíå", "üíò", "üíù", "üíñ", "üíó", "üíì", "üíû", "üíï", "üíü",
      "‚ù£Ô∏è", "üíî", "‚ù§Ô∏è‚Äçüî•", "‚ù§Ô∏è‚Äçü©π", "‚ù§Ô∏è", "‚ù£Ô∏è", "üíõ", "üíö", "üíô", "üß°",
      "üíú", "üñ§", "üíù", "üíè", "üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®", "üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©", "üíë", "üë®‚Äç‚ù§Ô∏è‚Äçüë®", "üë©‚Äç‚ù§Ô∏è‚Äçüë©", "üë™", "üë®‚Äçüë©‚Äçüë¶",
      "üë®‚Äçüë©‚Äçüëß", "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", "üë®‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë©‚Äçüëß‚Äçüëß", "üë©‚Äçüë©‚Äçüë¶", "üë©‚Äçüë©‚Äçüëß", "üë©‚Äçüë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüë©‚Äçüëß‚Äçüëß", "üë®‚Äçüë®‚Äçüë¶",
      "üë®‚Äçüë®‚Äçüëß", "üë®‚Äçüë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüë®‚Äçüëß‚Äçüëß", "üë®‚Äçüë¶", "üë®‚Äçüë¶‚Äçüë¶", "üë®‚Äçüëß", "üë®‚Äçüëß‚Äçüë¶", "üë®‚Äçüëß‚Äçüëß", "üë©‚Äçüë¶",
      "üë©‚Äçüë¶‚Äçüë¶", "üë©‚Äçüëß", "üë©‚Äçüëß‚Äçüë¶", "üë©‚Äçüëß‚Äçüëß", "üó£Ô∏è", "üë§", "üë•", "üí≠", "üí¨", "üóØÔ∏è",
      "üï≥Ô∏è", "üîÜ", "üîÖ", "üõÄ", "üõå", "üíå", "üíå", "üíº", "üì∑", "üñ®Ô∏è",
      "üì∫", "üìª", "üì±", "üíª", "‚å®Ô∏è", "üñ•Ô∏è", "üêÅ", "üïπÔ∏è", "üñ≤Ô∏è", "üì°",
      "üìû", "üìü", "üì†", "üì∫", "üìª", "üìª", "üéôÔ∏è", "üéõÔ∏è", "‚è∞", "‚è≥",
      "‚è∞", "‚è≥", "üå°Ô∏è", "‚åõÔ∏è", "üß≠", "‚úàÔ∏è", "üöÄ", "üöÅ", "üõ•Ô∏è", "‚õµÔ∏è",
      "üõ∂", "üö§", "üõ¥", "üö≤", "üö†", "üö°", "üöÇ", "üöÜ", "üöá", "üöù",
      "üöõ", "üöö", "üöó", "üöï", "üõµ", "üöë", "üöì", "üöö", "üöï", "üöì",
      "üö®", "üöí", "üöë", "üöó", "üöÉ", "üöé", "üöå", "üöç", "üöë", "üöî",
      "üöÉ", "üöÇ", "üöä", "üöã", "üèéÔ∏è", "üöî", "üöè", "üé´", "üöÜ", "üöÑ",
      "üõ§Ô∏è", "üõ£Ô∏è", "üöß", "‚õΩÔ∏è", "üèÅ", "üè•", "üè©", "üè®", "üè¶", "üè¢",
      "üè≠", "üè´", "üèØ", "üè∞", "üíí", "üóº", "üóΩ", "‚õ™Ô∏è", "‚õ≤Ô∏è", "üïå",
      "üïã", "‚õ©Ô∏è", "üåÅ", "üåÜ", "üåã", "üóª"
  ];
  
    const handleToggleDropdown = () => {
      setIsDropdownOpen(!isDropdownOpen);
    };
  
    const handleEmojiSelect = (emoji) => {
      let i;
      edges.forEach((edge) => {if (edge.id === id) i=edges.indexOf(edge) });
      edges[i].data.smile = emoji;
      console.log(edges);
      console.log(`–í—ã –≤—ã–±—Ä–∞–ª–∏ —Å–º–∞–π–ª: ${emoji}`);
      setEmj(`${emoji}`)
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω—É–∂–Ω—ã–µ –≤–∞–º –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–º–∞–π–ª–∞
    };
  
    return (
      <div className="relative inline-block">
        <button
          onClick={handleToggleDropdown}
          className="px-4 py-2 text-sm font-medium text-white rounded-full bg-yellow-300 mr-2"
        >
          {emj ? `${emj}` : `:)`}
        </button>
        {isDropdownOpen && (
          <div className="absolute mt-2 border-1 shadow-xl inline-block py-2 rounded-lg border-2 pl-2 pr-8">
            <div className='grid grid-cols-12 gap-x-6 gap-y-2'>
              {emojis.map((emoji, index) => (
                <div
                  key={index}
                  className="cursor-pointer hover:bg-gray-100"
                  onClick={() => handleEmojiSelect(emoji)}
                >
                  {emoji}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    );
  };

  return (
    <>
      <path
        id={id}
        //d={`M${sourceX} ${sourceY}, L${targetX} ${targetY}`}
        // x={(sourceX + targetX) / 2} y={(sourceY + targetY) / 2}
        d={`M${sourceX},${sourceY} C${sourceX},${curveY} ${targetX},${curveY} ${targetX},${targetY}`}
        className="CustomEdge"
      />
      <foreignObject x={curveX+50} y={curveY+50} width="1280" height="2400">
        <div className="flex items-center">
          <input
          type="text"
          value={label}
          onChange={handleInputChange}
          className='border-2 border-cyan-600 rounded-full px-2 py-1 text-sm mr-8'
        />
        <EmojiDropdown/>
        </div>
        
      </foreignObject>
    </>
  );
}

export default CustomEdge;